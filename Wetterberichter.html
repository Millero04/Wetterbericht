<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Notenübersicht</title>
</head>

<body>

    <h1>Notenübersicht</h1>
    <p>Notenschnitt
        <span id="schnitt">
            <!-- Hier kommt der Notenschnitt rein -->
        </span>
    </p>
    <table>
        <thead>
            <tr>
                <th>Datum</th>
                <th>Höchste Temperatur</th>
                <th>Tiefste Temperatur</th>
            </tr>
        </thead>
        <tbody id="tableBody">
            <!-- Hier kommen die Noten rein -->
        </tbody>
    </table>

    <br>
    <a href="wettertemperatur.html">Datum hinzufügen</a>

    <table>
        <thead>
            <tr>
                <th>Stadt</th>
                <th>Land</th>
                <th>Bild</th>
            </tr>
        </thead>
        <tbody id="tableBody2">
            <!-- Hier kommen die Noten rein -->
        </tbody>
    </table>

    <br>
    <a href="wetterort.html">Stadt hinzufügen</a>

    <script>
        function fetchTempData() {
            fetch('https://pb02.toiwxr.easypanel.host/api/collections/Temperatur/records', {
                method: 'GET',
                headers: {
                    'Content-Type': 'application/json'
                }
            })
                .then(response => response.json())
                .then(data => {
                    displayTempData(data);
                })
                .catch((error) => {
                    alert('Ein Fehler beim Laden der Daten ist aufgetreten. Bitte versuchen Sie es später erneut.');
                    console.error('Error:', error);
                });
        }

         function fetchStadtData() {
            fetch('https://pb02.toiwxr.easypanel.host/api/collections/Ortschaft/records', {
                method: 'GET',
                headers: {
                    'Content-Type': 'application/json'
                }
            })
                .then(response => response.json())
                .then(data => {
                    displayStadtData(data);
                })
                .catch((error) => {
                    alert('Ein Fehler beim Laden der Daten ist aufgetreten. Bitte versuchen Sie es später erneut.');
                    console.error('Error:', error);
                });
        }

        function displayTempData(data) {
            console.log(data)
            const items = data.items;

            const tableBodyElement = document.getElementById('tableBody');
            tableBodyElement.innerHTML = '';

            let innerHtml = '';
            for (let item of items) {
                /**
                 * Aufgabe 1
                 * Ergänzen Sie den HTML Code, sodass neben jeder Note ein "bearbeiten" button angezeigt wird.
                 * */
                innerHtml += `
                    <tr>
                        <td>${item.datum}</td>
                        <td>${item.hoechsteTemp}</td>
                        <td>${item.tiefsteTemp}</td>
                        <td onclick="loeschen('${item.id}')">löschen</td>
                        <td onclick="bearbeiten('${item.id}')">bearbeiten</td>
                    </tr>`;
            }
            tableBodyElement.innerHTML = innerHtml;
        }

        function displayStadtData(data) {
            console.log("data",data)
            const items = data.items;

            const tableBodyElement = document.getElementById('tableBody2');
            tableBodyElement.innerHTML = '';

            let innerHtml = '';
            for (let item of items) { 
                /**
                 * Aufgabe 1
                 * Ergänzen Sie den HTML Code, sodass neben jeder Note ein "bearbeiten" button angezeigt wird.
                 * */
                
                innerHtml += `
                    <tr>
                        <td>${item.stadt}</td>
                        <td>${item.land}</td>
                        <img src="https://pb02.toiwxr.easypanel.host/api/files/Ortschaft/${item.id}/${item.bild}">
                        <td onclick="loeschen2('${item.id}')">löschen</td>
                        <td onclick="bearbeiten2('${item.id}')">bearbeiten</td>
                    </tr>`;
            }
            tableBodyElement.innerHTML = innerHtml;
        }

        /***
         * Aufgabe 2
         * Diese Funktion muss aufgerugen werden, wenn der Benutzer neben einer Note auf "bearbeiten" klickt.
         * */
        function bearbeiten(itemId) {
            // Hier wird die note-hinzufuegen.html Seite geöffnet und die noteId als Query Parameter übergeben.
            window.open('wettertemperatur.html?datumId=' + itemId, '_self');
        }

        function loeschen(itemId) {
            fetch('https://pb02.toiwxr.easypanel.host/api/collections/Temperatur/records/' + itemId, {
                method: 'DELETE',
                headers: {
                    'Content-Type': 'application/json'
                }
            })
                .then(data => {
                    alert('Item wurde erfolgreich gelöscht.');
                    fetchTempData(data);
                })
                .catch((error) => {
                    alert('Ein Fehler beim Laden der Daten ist aufgetreten. Bitte versuchen Sie es später erneut.');
                    console.error('Error:', error);
                });
        }

        fetchTempData();
        
        function bearbeiten2(itemId) {
            // Hier wird die note-hinzufuegen.html Seite geöffnet und die noteId als Query Parameter übergeben.
            window.open('wettertemperatur.html?datumId=' + itemId, '_self');
        }

        function loeschen2(itemId) {
            fetch('https://pb02.toiwxr.easypanel.host/api/collections/Ortschaft/records/' + itemId, {
                method: 'DELETE',
                headers: {
                    'Content-Type': 'application/json'
                }
            })
                .then(data => {
                    alert('Item wurde erfolgreich gelöscht.');
                    fetchStadtData(data);
                })
                .catch((error) => {
                    alert('Ein Fehler beim Laden der Daten ist aufgetreten. Bitte versuchen Sie es später erneut.');
                    console.error('Error:', error);
                });
        }

        fetchStadtData();
    </script>

</body>

</html>